<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96224610-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-96224610-1');
  </script>
	<meta charset="utf-8">
	<title>Callbacks, Part 1: Delegate, NotificationCenter, and KVO - Alexey Naumov</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Alexey Naumov" property="og:site_name">
  
    <meta content="Callbacks, Part 1: Delegate, NotificationCenter, and KVO" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Comparison of callback techniques in iOS, pros & cons" property="og:description">
  
  
    <meta content="http://nalexn.github.io/callbacks-part-1-delegation-notificationcenter-kvo/" property="og:url">
  
  
    <meta content="2018-01-28T18:30:00+03:00" property="article:published_time">
    <meta content="http://nalexn.github.io/about/" property="article:author">
  
  
    <meta content="http://nalexn.github.io/assets/img/tools_001.jpg" property="og:image">
  
  
    
  
  
    <meta name="keywords" content="delegate, delegation, notification, center, key, value, observing, kvo">
    
    <meta content="delegate" property="article:tag">
    
    <meta content="delegation" property="article:tag">
    
    <meta content="notification" property="article:tag">
    
    <meta content="center" property="article:tag">
    
    <meta content="key" property="article:tag">
    
    <meta content="value" property="article:tag">
    
    <meta content="observing" property="article:tag">
    
    <meta content="kvo" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@nallexn">
  
    <meta name="twitter:title" content="Callbacks, Part 1: Delegate, NotificationCenter, and KVO">
  
  
    <meta name="twitter:url" content="http://nalexn.github.io/callbacks-part-1-delegation-notificationcenter-kvo/">
  
  
    <meta name="twitter:description" content="Comparison of callback techniques in iOS, pros & cons">
  

	<meta name="description" content="Comparison of callback techniques in iOS, pros & cons">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
  <link rel="icon" sizes="16x16" href="/assets/img/favicon/favicon.ico">
  <link rel="icon" sizes="32x32" href="/assets/img/favicon/favicon-32.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/favicon-114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css?v=2">
</head>

<body>
  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="author-logo">
      <span class="hover-message">Let's connect on LinkedIn!</span>
      <div class="cover-author-image">
        <a href="https://in.linkedin.com/in/nalexn" target="_blank"><img src="/assets/img/profile-image.jpg" alt="Alexey Naumov"></a>
      </div>
      </div>
      <div class="author-name">Alexey Naumov</div>
      <a href="/"><img src="/assets/img/content_00.png" alt="" style="-webkit-border-radius: 0%; border-radius: 0%;"></a>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Links</h3>
      <ul>
        <li><a href="https://twitter.com/nallexn" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        <li><a href="https://in.linkedin.com/in/nalexn" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a href="https://github.com/nalexn" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a href="https://stackoverflow.com/users/2923345?tab=profile" target="_blank"><i class="fa fa-stack-overflow" aria-hidden="true"></i></a></li>
        <li><a href="http://nalexn.github.io/feed.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2020 &copy; Alexey Naumov</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Callbacks, Part 1: Delegate, NotificationCenter, and KVO</h1>
        <div class="page-date"><span>2018, Jan 28&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <div class="page-image"><img class="page-image" src=/assets/img/tools_001.jpg alt="Callbacks, Part 1: Delegate, NotificationCenter, and KVO"></div>
      <p>This article kicks off the series of posts about callback techniques in <a href="https://en.wikipedia.org/wiki/Cocoa_(API)">Cocoa</a>, their comparison &amp; benchmarking. If you’re familiar with the concepts of <code class="language-plaintext highlighter-rouge">delegation</code>, <code class="language-plaintext highlighter-rouge">NotificationCenter</code> and <code class="language-plaintext highlighter-rouge">Key-Value Observing</code>, you might want to skip the introduction and go straight to the <strong>Pros &amp; Cons</strong> of each. Happy reading!</p>

<p><a href="/callbacks-part-2-closure-target-action-responder-chain/">Callbacks, Part 2: Closure, Target-Action, and Responder Chain</a></p>

<p><a href="/callbacks-part-3-promise-event-stream/">Callbacks, Part 3: Promise, Event, and Stream (Functional Reactive Programming)</a></p>

<h1 id="delegate"><a name="delegate"><a href="#delegate">delegate</a></a></h1>

<p><code class="language-plaintext highlighter-rouge">delegate</code> is the most common type of <a href="https://en.wikipedia.org/wiki/Loose_coupling">loose</a> connection between entities is Cocoa, but nonetheless, this approach can be used in other languages and platforms as this is basically a <a href="https://en.wikipedia.org/wiki/Delegation_pattern">delegation design pattern</a>.</p>

<p>The idea is simple - instead of interacting with an object through its real API we can instead omit the details of which exact type we talk to and instead use <code class="language-plaintext highlighter-rouge">protocol</code> with a subset of methods that we need. We define the protocol ourselves and only list those methods we’re going to call at our opponent. A real object then would need to implement this protocol, and probably other methods - but we won’t know about it - and that’s good! <a href="https://en.wikipedia.org/wiki/Loose_coupling">Loose coupling</a>, remember?</p>

<p>Let’s see an example. Suppose we have a <a name="Pizzeria_Problem">Pizzeria</a>, with a man who makes the pizza (<strong>pizzaiolo</strong>), and a <strong>customer</strong> who orders the pizza. The <code class="language-plaintext highlighter-rouge">pizzaiolo</code> should not know all the details about who exactly is the <code class="language-plaintext highlighter-rouge">customer</code> (could it be Queen Elizabeth, or Snoop Dogg, or just a dog…), the only thing that matters is the customer’s ability to take the pizza when it is ready. This is how we would implement this problem with <code class="language-plaintext highlighter-rouge">delegate</code> in Swift:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre>
<span class="c1">// The protocol the Pizzaiolo is using for "calling back" to customer</span>
<span class="kd">protocol</span> <span class="kt">PizzaTaker</span> <span class="p">{</span>
  <span class="kd">func</span> <span class="nf">take</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="kt">Pizza</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Pizzaiolo</span> <span class="p">{</span>
  <span class="c1">// We store a reference to a PizzaTaker rather than to a Customer</span>
  <span class="k">var</span> <span class="nv">pizzaTaker</span><span class="p">:</span> <span class="kt">PizzaTaker</span><span class="p">?</span>

  <span class="c1">// The method a customer can call to ask Pizzaiolo to make a pizza</span>
  <span class="kd">func</span> <span class="nf">makePizza</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="c1">// As soon as the pizza is ready the `onPizzaIsReady` function is called</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">func</span> <span class="nf">onPizzaIsReady</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="kt">Pizza</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Pizzaiolo provides the pizza to a PizzaTaker</span>
    <span class="n">pizzaTaker</span><span class="p">?</span><span class="o">.</span><span class="nf">take</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="n">pizza</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Class Customer implements the protocol PizzaTaker - the only requirement</span>
<span class="c1">// which allows him to get a pizza from Pizzaiolo</span>
<span class="kd">class</span> <span class="kt">Customer</span><span class="p">:</span> <span class="kt">PizzaTaker</span> <span class="p">{</span>

  <span class="c1">// Some details related to Customer class which Pizzaiolo should not know about</span>
  <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
  <span class="k">var</span> <span class="nv">dateOfBirth</span><span class="p">:</span> <span class="kt">Date</span>

  <span class="c1">// Implementation of the PizzaTaker protocol</span>
  <span class="kd">func</span> <span class="nf">take</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="kt">Pizza</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// yummy!</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="advantages-of-using-delegate"><a name="delegate_advantages"><a href="#delegate_advantages">Advantages of using delegate</a></a></h2>

<ul>
  <li>Loose coupling. Indeed, with delegate pattern, we have interacting parties decoupled from each other without exposure of who exactly they are. We can easily implement the protocol <code class="language-plaintext highlighter-rouge">PizzaTaker</code> in other class <code class="language-plaintext highlighter-rouge">Dumpster</code> and make all fresh pizzas end up in a trash can instead of being eaten, without <code class="language-plaintext highlighter-rouge">Pizzaiolo</code> even knowing something has changed.</li>
  <li>IDE (such as Xcode) is able to check the connection for correctness with static analysis. This is a great advantage because connections between objects can break when you refactor things, and IDE will point you out the problem even before you try to build the project.</li>
  <li>Ability to get a non-<code class="language-plaintext highlighter-rouge">void</code> result from calling the <code class="language-plaintext highlighter-rouge">delegate</code>. Unlike many other callback techniques, with the delegate, you can not only <em>notify</em> but also <em>ask for data</em>. In Cocoa, you can often see <code class="language-plaintext highlighter-rouge">DataSource</code> protocols, which stand exactly for this purpose.</li>
  <li>Speed. Since calling a method on a delegate is nothing more than the direct call of a function, with <code class="language-plaintext highlighter-rouge">delegate</code> you can achieve absolutely best performance among other callback techniques, which have to spend time on more sophisticated delivery of the call.</li>
</ul>

<h2 id="disadvantages-of-using-delegate"><a name="delegate_disadvantages"><a href="#delegate_disadvantages">Disadvantages of using delegate</a></a></h2>

<ul>
  <li>Single recipient. Even with our Pizzeria example above, <code class="language-plaintext highlighter-rouge">pizzaiolo</code> is simply unable to serve multiple pizzas at a time for more than one <code class="language-plaintext highlighter-rouge">customer</code>, and moreover if another <code class="language-plaintext highlighter-rouge">customer</code> comes while the pizza for the previous <code class="language-plaintext highlighter-rouge">customer</code> is still being cooked, things will totally mess up: the new <code class="language-plaintext highlighter-rouge">customer</code> will <strong>overwrite</strong> the <code class="language-plaintext highlighter-rouge">pizzaTaker</code> reference on <code class="language-plaintext highlighter-rouge">pizzaiolo</code> to himself and the previous <code class="language-plaintext highlighter-rouge">customer</code> will never get his pizza! Awful service…</li>
  <li>Distribution of closely related business logic (aka <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)">low cohesion</a>). Since all the callback methods have to be implemented as separate functions inside the recipient we cannot use anonymous functions and get <em>the action</em> and <em>the callback for the action</em> nested near each other. So sometimes it’s hard to reason about under which conditions the callback is called.</li>
  <li>Cumbersome infrastructure. In order to use <code class="language-plaintext highlighter-rouge">delegate</code> we need to do quite a few steps:
    <ul>
      <li>define a new protocol</li>
      <li>define a weak property for the delegate</li>
      <li>implement the protocol in the target type</li>
      <li>assign the delegate reference.</li>
      <li>[Obj-C] check if the delegate can handle the message with <code class="language-plaintext highlighter-rouge">respondsToSelector:</code></li>
    </ul>
  </li>
  <li>Promotes the emergence of <a href="https://www.smashingmagazine.com/2016/05/better-architecture-for-ios-apps-model-view-controller-pattern/">Massive View Controller</a>. Because of the popularity of this pattern in Cocoa your classes quickly become a convention of delegates if you do nothing so split them out.</li>
</ul>

<h1 id="notificationcenter"><a name="NotificationCenter"><a href="#NotificationCenter">NotificationCenter</a></a></h1>

<p><code class="language-plaintext highlighter-rouge">NotificationCenter</code> (or <code class="language-plaintext highlighter-rouge">NSNotificationCenter</code> for Objective-C) is a class in Cocoa which provides the <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">publish – subscribe</a> functionality, and as you can guess from its name, it deals with <em>Notifications</em>. The notifications it sends around are objects of <code class="language-plaintext highlighter-rouge">Notification</code> class, which can carry an optional payload, but more often are used just as notices. The <code class="language-plaintext highlighter-rouge">NotificationCenter</code> itself is a <em>data bus</em>, it doesn’t send notifications on its own, only when someone <em>askes</em> it to send one. The main feature of this pattern is that the <code class="language-plaintext highlighter-rouge">sender</code> and <code class="language-plaintext highlighter-rouge">recipients</code> (there can be many) do not talk directly, like with <code class="language-plaintext highlighter-rouge">delegate</code> pattern. Instead, they both talk to <code class="language-plaintext highlighter-rouge">NotificationCenter</code> - the sender calls method <code class="language-plaintext highlighter-rouge">postNotification</code> on the <code class="language-plaintext highlighter-rouge">NotificationCenter</code> to send a notification, while recipients opt-in for receiving the notifications by calling <code class="language-plaintext highlighter-rouge">addObserver</code> on <code class="language-plaintext highlighter-rouge">NotificationCenter</code>. They can later opt-out with <code class="language-plaintext highlighter-rouge">removeObserver</code>. Important note though is that <code class="language-plaintext highlighter-rouge">NotificationCenter</code> does not store notifications for future subscribers - only present subscribers receive the notifications.</p>

<p>The <code class="language-plaintext highlighter-rouge">NotificationCenter</code> also provides a global access point <code class="language-plaintext highlighter-rouge">defaultCenter</code>, however, this class is not implemented as a pure <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singleton</a> - you can create your own instances of <code class="language-plaintext highlighter-rouge">NotificationCenter</code> (and you probably should).</p>

<p>Implementation of the same case with <em>Pizzeria</em>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre></td><td class="rouge-code"><pre>
<span class="c1">// First step is to declare new notification type - to be identified by sender and recipients</span>
<span class="kd">extension</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">let</span> <span class="nv">PizzaReadiness</span> <span class="o">=</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="s">"pizza_is_ready"</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Pizzaiolo</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">makePizza</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">...</span>
  <span class="p">}</span>
  
  <span class="kd">private</span> <span class="kd">func</span> <span class="nf">onPizzaIsReady</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="kt">Pizza</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Pizzaiolo notifies all interested parties that the pizza is ready:</span>
    <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span><span class="o">.</span><span class="kt">PizzaReadiness</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="p">[</span><span class="s">"pizza_object"</span> <span class="p">:</span> <span class="n">pizza</span><span class="p">])</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Customer</span> <span class="p">{</span>
  
  <span class="c1">// If a customer wants to get a pizza he needs to register as an observer at NotificationCenter</span>
  <span class="kd">func</span> <span class="nf">startListeningWhenPizzaIsReady</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// A customer subscribes for all notifications of type NSNotification.Name.PizzaReadiness</span>
    <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">selector</span><span class="p">:</span> <span class="kd">#selector(</span><span class="nf">pizzaIsReady(notification:)</span><span class="kd">)</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span><span class="o">.</span><span class="kt">PizzaReadiness</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="c1">// The customer should opt-out of notifications when he's not interested in them anymore</span>
  <span class="kd">func</span> <span class="nf">stopListeningWhenPizzaIsReady</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">removeObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">NSNotification</span><span class="o">.</span><span class="kt">Name</span><span class="o">.</span><span class="kt">PizzaReadiness</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
  <span class="p">}</span>
  
  <span class="kd">dynamic</span> <span class="kd">func</span> <span class="nf">pizzaIsReady</span><span class="p">(</span><span class="nv">notification</span><span class="p">:</span> <span class="kt">Notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">pizza</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">userInfo</span><span class="p">?[</span><span class="s">"pizza_object"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Pizza</span> <span class="p">{</span>
      <span class="c1">// Got the pizza!</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="advantages-of-using-notificationcenter"><a name="NotificationCenter_advantages"><a href="#NotificationCenter_advantages">Advantages of using NotificationCenter</a></a></h2>

<ul>
  <li>Multiple recipients. <code class="language-plaintext highlighter-rouge">NotificationCenter</code> transparently delivers a <code class="language-plaintext highlighter-rouge">Notification</code> to all subscribers, could there be one, or thousand, or none - this class will take care of the delivery for you. What’s also notable - the <code class="language-plaintext highlighter-rouge">sender</code> cannot know how many subscribers he has. Not to say it’s good or bad, it’s just how this tool is designed.</li>
  <li>Loose coupling. When using <code class="language-plaintext highlighter-rouge">NotificationCenter</code> the only thing that couples <code class="language-plaintext highlighter-rouge">sender</code> and <code class="language-plaintext highlighter-rouge">receivers</code> together is the name of the notification they use for their communication. If you include a payload to the notification, both parties would need to have symmetric boxing and unboxing of the data.</li>
  <li>Global access point. When you don’t need (or just don’t care about) the <a href="https://en.wikipedia.org/wiki/Dependency_injection">dependency injections</a> in your code, the singleton-style method <code class="language-plaintext highlighter-rouge">defaultCenter</code> allows you to connect two random objects together with ease.</li>
</ul>

<h2 id="disadvantages-of-using-notificationcenter"><a name="NotificationCenter_disadvantages"><a href="#NotificationCenter_disadvantages">Disadvantages of using NotificationCenter</a></a></h2>

<ul>
  <li>Global access point. Yes, this is also a disadvantage. Any globally accessible stuff breaks the testability of your code and even <code class="language-plaintext highlighter-rouge">singleton</code> as a design pattern <a href="http://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons">many people consider</a> as an anty-pattern.</li>
  <li>Inability to step-in with a debugger. The only way you can debug <code class="language-plaintext highlighter-rouge">NotificationCenter</code> is by placing breakpoints</li>
  <li>Non-obvious control flow. If you are trying to understand the business logic of the program and see a place where a <code class="language-plaintext highlighter-rouge">Notification</code> is sent - the only way to continue exploration is by finding all the recipients manually with a <em>text search</em> in the entire project - because they can be anywhere!</li>
  <li>Transferring data is very error-prone because of boxing and unboxing with a <code class="language-plaintext highlighter-rouge">Dictionary</code> (<code class="language-plaintext highlighter-rouge">NSDictionary</code>). Even when used from type-safe Swift, the compiler cannot check the types as well as the structure of the <code class="language-plaintext highlighter-rouge">Dictionary</code>.</li>
  <li>Recipients must unsubscribe when they are about to deallocate or the app may crash. This requirement has been removed only in iOS 8, but this will haunt iOS developers in their nightmares for years.</li>
  <li>The sender cannot get a non-<code class="language-plaintext highlighter-rouge">void</code> result, as opposed to the <code class="language-plaintext highlighter-rouge">delegate</code> and <code class="language-plaintext highlighter-rouge">closure</code></li>
  <li>Third-party libs may rely on the same notifications as your code and interfere with each other. Great example is the <code class="language-plaintext highlighter-rouge">NSManagedObjectContextDidSaveNotification</code> from <strong>CoreData</strong> framework - every party should <a href="http://stackoverflow.com/questions/17568667/ios-googleanalytic-continuously-produce-an-exception/27739971#27739971">properly handle</a> this notification or the app can crash.</li>
  <li>There is no control over who is eligible of sending the particular notification. A junior developer on your team may come up to send a system notification like <code class="language-plaintext highlighter-rouge">UIApplicationWillEnterForegroundNotification</code> to fix a weird bug in his code, and the entire system can get screwed up. Funny, huh?</li>
  <li>When overused, <code class="language-plaintext highlighter-rouge">NotificationCenter</code> can turn your project into hell because of the previous points</li>
</ul>

<h1 id="key-value-observing"><a name="KeyValueObserving"><a href="#KeyValueObserving">Key Value Observing</a></a></h1>

<p>There is a <a href="http://nalexn.github.io/kvo-guide-for-key-value-observing">dedicated post</a> I’ve written about KVO in Swift 5 and Objective-C.</p>

<p><code class="language-plaintext highlighter-rouge">KVO</code> is a traditional <a href="https://en.wikipedia.org/wiki/Observer_pattern">observer</a> pattern built-in any <code class="language-plaintext highlighter-rouge">NSObject</code> out of the box. With <code class="language-plaintext highlighter-rouge">KVO</code> observers can be notified of any changes of a <code class="language-plaintext highlighter-rouge">@property</code> values. It leverages <em>Objective-C runtime</em> for automated notifications dispatch, and because of that for <code class="language-plaintext highlighter-rouge">Swift</code> class, you’d need to opt into <em>Objective-C dynamism</em> by inheriting <code class="language-plaintext highlighter-rouge">NSObject</code> and marking the <code class="language-plaintext highlighter-rouge">var</code> you’re going to observe with modifier <code class="language-plaintext highlighter-rouge">dynamic</code>. The observers should also be <code class="language-plaintext highlighter-rouge">NSObject</code> descendants because this is enforced by the <code class="language-plaintext highlighter-rouge">KVO</code> API.</p>

<p>Sample code for <code class="language-plaintext highlighter-rouge">Key-Value Observing</code> a property <code class="language-plaintext highlighter-rouge">value</code> of the class <code class="language-plaintext highlighter-rouge">ObservedClass</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="kt">ObservedClass</span> <span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
  <span class="kd">@objc</span> <span class="kd">dynamic</span> <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Observer</span> <span class="p">{</span>
  <span class="k">var</span> <span class="nv">kvoToken</span><span class="p">:</span> <span class="kt">NSKeyValueObservation</span><span class="p">?</span>
    
  <span class="kd">func</span> <span class="nf">observe</span><span class="p">(</span><span class="nv">object</span><span class="p">:</span> <span class="kt">ObservedClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">kvoToken</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="nf">observe</span><span class="p">(\</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="k">new</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">change</span><span class="p">)</span> <span class="k">in</span>
      <span class="k">guard</span> <span class="k">let</span> <span class="nv">value</span> <span class="o">=</span> <span class="n">change</span><span class="o">.</span><span class="k">new</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"New value is: </span><span class="se">\(</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
  <span class="kd">deinit</span> <span class="p">{</span>
    <span class="n">kvoToken</span><span class="p">?</span><span class="o">.</span><span class="nf">invalidate</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="advantages-of-using-key-value-observing"><a name="KeyValueObserving_advantages"><a href="#KeyValueObserving_advantages">Advantages of using Key-Value Observing</a></a></h2>
<ul>
  <li>Observation pattern in a few lines of code. Normally you would need to implement it yourself, but in <code class="language-plaintext highlighter-rouge">Cocoa</code> you have this feature coming standard for every <code class="language-plaintext highlighter-rouge">NSObject</code>.</li>
  <li>Multiple observers - there is no limitation on the number of subscribers.</li>
  <li>There is no need to change the source code of the class under observation</li>
  <li>Because of the aforementioned you can observe objects of <em>any</em> class (including those from system frameworks, to which sources we don’t have access thus cannot modify)</li>
  <li>Very low coupling (<a href="https://en.wikipedia.org/wiki/Connascence_(computer_programming)#Static_Connascences">connascence of name</a>) - the observed party doesn’t even know it’s being observed, the observing party’s knowledge is bounded by the name of the <code class="language-plaintext highlighter-rouge">@property</code></li>
  <li>Notification can be configured to deliver not only the most recent value of the observed <code class="language-plaintext highlighter-rouge">@property</code> but also the previous value.</li>
</ul>

<h2 id="disadvantages-of-using-key-value-observing"><a name="KeyValueObserving_disadvantages"><a href="#KeyValueObserving_disadvantages">Disadvantages of using Key-Value Observing</a></a></h2>
<ul>
  <li>One of the worst APIs across Cocoa. This point could be easily broken up in several - <a href="https://www.mikeash.com/pyblog/key-value-observing-done-right.html">so</a> <a href="http://khanlou.com/2013/12/kvo-considered-harmful/">bad</a> <a href="https://ianthehenry.com/2014/5/4/kvo-101/">it</a> <a href="http://nshipster.com/key-value-observing/">is</a>. Good for us there are <a href="https://github.com/facebook/KVOController">nicer</a> <a href="https://github.com/postmates/PMKVObserver">alternative</a> implementations of the <code class="language-plaintext highlighter-rouge">KVO</code>.</li>
  <li><em>keyPath</em> used for subscription is a string, and it cannot be statically verified. Luckily this has a solution in Swift (<code class="language-plaintext highlighter-rouge">#keyPath</code> directive), but in Objective-C, if the observed party changes the name of the <code class="language-plaintext highlighter-rouge">@property</code> - there won’t be a compiler warning about this, so the app will just crash in runtime.</li>
  <li>Each observer has to explicitly unsubscribe on <code class="language-plaintext highlighter-rouge">deinit</code> - otherwise crash is unavoidable.</li>
  <li>We have to call the <code class="language-plaintext highlighter-rouge">super</code> implementation of <code class="language-plaintext highlighter-rouge">observeValueForKeyPath</code> callback function to make sure we don’t break the implementation of the superclass.</li>
  <li>Relatively slow performance. Even when compiled with <code class="language-plaintext highlighter-rouge">-Os</code> optimization, for <code class="language-plaintext highlighter-rouge">Objective-C</code> one <code class="language-plaintext highlighter-rouge">KVO</code> notification is <em>30 times</em> slower than a function call, for <code class="language-plaintext highlighter-rouge">Swift</code> it is <em>200 times</em> slower. I have used <a href="https://github.com/nalexn/PerformanceTestTools">this project</a> for benchmarking.</li>
</ul>

<hr />
<p>Be safe, wash your hands before eating, and write clean code.</p>

      <h2>Your appreciation is my inspiration!</h2>
      <p>I have tons of unpublished kick-ass materials and ideas, but I need your help! Consider sharing this article on <a href="https://twitter.com/share?url=http://nalexn.github.io/callbacks-part-1-delegation-notificationcenter-kvo/?utm_source=share_tw&amp;text=Callbacks, Part 1: Delegate, NotificationCenter, and KVO&amp;hashtags=iosdev&amp;via=nallexn" title="Twitter" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-twitter share-button"></i></a>, <a href="https://www.facebook.com/sharer/sharer.php?u=http://nalexn.github.io/callbacks-part-1-delegation-notificationcenter-kvo/?utm_source=share_fb&amp;display=popup&amp;quote=Callbacks, Part 1: Delegate, NotificationCenter, and KVO&amp;hashtag=#iosdev" title="Facebook" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-facebook-f share-button"></i></a> or <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://nalexn.github.io/callbacks-part-1-delegation-notificationcenter-kvo/?utm_source=share_in" title="LinkedIn" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-linkedin share-button"></i></a>. This tiny action helps to grow this blog and inspires me to post more! (Or if you are nuts, <a href="https://venmo.com/nallexn" target="_blank">Venmo</a> me a drink!)</p>
      </p>
      <p>You can subscribe to <a href="http://nalexn.github.io/feed.xml" target="_blank">RSS feed</a> or follow my <a href="https://twitter.com/nallexn" target="_blank">Twitter</a> for the new articles alerts.

      <div style="width:0px; height:30px; display: block;"></div>
      <h2>Most recent articles</h2>
      <div class="content-box recent clearfix" style="padding: 20px 10px;">
        
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/layers_001.jpg)" href="/separation-of-concerns/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/separation-of-concerns/">Separation of Concerns in Software Design</a></h2>
              <p></p>
              <span class="post-date">2020, Jan 16&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">10 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/observable_001.jpg)" href="/swiftui-observableobject/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-observableobject/">Why I quit using the ObservableObject</a></h2>
              <p></p>
              <span class="post-date">2019, Dec 20&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">7 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/comparison_01.jpg)" href="/anyview-vs-group/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/anyview-vs-group/">Performance Battle: AnyView vs Group</a></h2>
              <p></p>
              <span class="post-date">2019, Dec 05&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">9 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/swiftui_unit_testing_01.jpg)" href="/swiftui-unit-testing/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-unit-testing/">Who said we cannot unit test SwiftUI views?</a></h2>
              <p></p>
              <span class="post-date">2019, Nov 21&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">12 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/deep_link_swiftui_01.jpg)" href="/swiftui-deep-linking/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-deep-linking/">Programmatic navigation in SwiftUI project</a></h2>
              <p></p>
              <span class="post-date">2019, Nov 08&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">7 minute read</span>
            </div>
          </article>
          
        
        <article class="post">
          <a class="post-thumbnail" style="background-image: url(/assets/img/launch_001.jpg)" href="/"></a>
          <div class="post-content">
            <h2 class="post-title"><a href="/">Browse All Articles</a></h2>
            <p></p>
            <span class="post-date">Top iOS programming stuff, no kidding!</span>
          </div>
        </article>
      </div>
    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
</body>
</html>
