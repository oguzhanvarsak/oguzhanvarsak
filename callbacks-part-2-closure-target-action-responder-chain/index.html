<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96224610-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-96224610-1');
  </script>
	<meta charset="utf-8">
	<title>Callbacks, Part 2: Closure, Target-Action, and Responder chain - Alexey Naumov</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Alexey Naumov" property="og:site_name">
  
    <meta content="Callbacks, Part 2: Closure, Target-Action, and Responder chain" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Comparison of callback techniques in iOS, pros & cons" property="og:description">
  
  
    <meta content="http://nalexn.github.io/callbacks-part-2-closure-target-action-responder-chain/" property="og:url">
  
  
    <meta content="2018-02-08T18:30:00+03:00" property="article:published_time">
    <meta content="http://nalexn.github.io/about/" property="article:author">
  
  
    <meta content="http://nalexn.github.io/assets/img/tools_003.jpg" property="og:image">
  
  
    
  
  
    <meta name="keywords" content="closure, block, target, action, target-action, responder, chain">
    
    <meta content="closure" property="article:tag">
    
    <meta content="block" property="article:tag">
    
    <meta content="target" property="article:tag">
    
    <meta content="action" property="article:tag">
    
    <meta content="target-action" property="article:tag">
    
    <meta content="responder" property="article:tag">
    
    <meta content="chain" property="article:tag">
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@nallexn">
  
    <meta name="twitter:title" content="Callbacks, Part 2: Closure, Target-Action, and Responder chain">
  
  
    <meta name="twitter:url" content="http://nalexn.github.io/callbacks-part-2-closure-target-action-responder-chain/">
  
  
    <meta name="twitter:description" content="Comparison of callback techniques in iOS, pros & cons">
  

	<meta name="description" content="Comparison of callback techniques in iOS, pros & cons">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
  <link rel="icon" sizes="16x16" href="/assets/img/favicon/favicon.ico">
  <link rel="icon" sizes="32x32" href="/assets/img/favicon/favicon-32.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/favicon-114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css?v=2">
</head>

<body>
  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="author-logo">
      <span class="hover-message">Let's connect on LinkedIn!</span>
      <div class="cover-author-image">
        <a href="https://in.linkedin.com/in/nalexn" target="_blank"><img src="/assets/img/profile-image.jpg" alt="Alexey Naumov"></a>
      </div>
      </div>
      <div class="author-name">Alexey Naumov</div>
      <a href="/"><img src="/assets/img/content_00.png" alt="" style="-webkit-border-radius: 0%; border-radius: 0%;"></a>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Links</h3>
      <ul>
        <li><a href="https://twitter.com/nallexn" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        <li><a href="https://in.linkedin.com/in/nalexn" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a href="https://github.com/nalexn" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a href="https://stackoverflow.com/users/2923345?tab=profile" target="_blank"><i class="fa fa-stack-overflow" aria-hidden="true"></i></a></li>
        <li><a href="http://nalexn.github.io/feed.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2020 &copy; Alexey Naumov</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Callbacks, Part 2: Closure, Target-Action, and Responder chain</h1>
        <div class="page-date"><span>2018, Feb 08&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <div class="page-image"><img class="page-image" src=/assets/img/tools_003.jpg alt="Callbacks, Part 2: Closure, Target-Action, and Responder chain"></div>
      <p>This article continues the series of posts about callback techniques in <a href="https://en.wikipedia.org/wiki/Cocoa_(API)">Cocoa</a>, their comparison &amp; benchmarking. If you’re familiar with the concepts of <code class="language-plaintext highlighter-rouge">Closure</code>, <code class="language-plaintext highlighter-rouge">Target-Action</code> and <code class="language-plaintext highlighter-rouge">Responder chain</code>, you might want to skip the introduction and go straight to the <strong>Pros &amp; Cons</strong> of each. Happy reading!</p>

<p><a href="/callbacks-part-1-delegation-notificationcenter-kvo/">Callbacks, Part 1: Delegation, NotificationCenter, and KVO</a></p>

<p><a href="/callbacks-part-3-promise-event-stream/">Callbacks, Part 3: Promise, Event, and Stream (Functional Reactive Programming)</a></p>

<h1 id="closure-block"><a name="Closure_Block"><a href="#Closure_Block">Closure (Block)</a></a></h1>

<p>Although this series of the posts is called <em>“Callbacks in Cocoa”</em>, the word “callback” is usually used as a synonym for <em>Closure</em> (or <em>Block</em>).</p>

<p>Closure and Block are two names for the same phenomenon used in Swift and Objective-C respectively.</p>

<p>The <a href="https://developer.apple.com/library/prerelease/content/documentation/Swift/Conceptual/Swift_Programming_Language/Closures.html">documentation</a> says that the <em>“Closures are self-contained blocks of functionality that can be passed around…“</em>.</p>

<p>If you think about it, regular <em>objects</em> of any class are also “self-contained blocks of functionality” that can be “passed around” by the reference, but Closure is its own beast.</p>

<p>Just like objects, a Closure has associated “functionality”, that is some code to be executed, and also Closure can capture <em>variables</em> and operate with them as would an object do with its own variables.</p>

<p>The key difference is that the functionality of an object is declared by its class implementation, which is a standalone structure, but for Closure, we write its implementation in place of use, where it’s passed somewhere else as a parameter.</p>

<p>Although a Closure has characteristics of an object, to a bigger extent it is a <em>function</em>. Because this function is declared without association to a type, it is also called <a href="https://en.wikipedia.org/wiki/Anonymous_function">anonymous function</a>.</p>

<p>The easiest way to grasp the concept is to see an example, and if we are to solve the <em>Pizzeria</em> problem from the <a href="/callbacks-part-1-delegation-notificationcenter-kvo/#Pizzeria_Problem">previous post</a>, we could end up with the following code:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="c1">// The Closure type can be pre-defined, and since it's an anonymous function, its declaration</span>
<span class="c1">// looks like a function signature. In our case - a void function that takes a Pizza</span>
<span class="kd">typealias</span> <span class="kt">PizzaClosure</span> <span class="o">=</span> <span class="p">(</span><span class="kt">Pizza</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>

<span class="kd">class</span> <span class="kt">Pizzaiolo</span> <span class="p">{</span>

  <span class="c1">// "An instance" of the PizzaClosure can be treated just as an object</span>
  <span class="kd">private</span> <span class="k">var</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">PizzaClosure</span><span class="p">?</span>

  <span class="c1">// PizzaClosure will be passed in as a parameter</span>
  <span class="kd">func</span> <span class="nf">makePizza</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">PizzaClosure</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Save the 'completion' to be able to call it later</span>
    <span class="k">self</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="n">completion</span>
    <span class="c1">// Cooking the pizza</span>
    <span class="o">...</span>
  <span class="p">}</span>
  
  <span class="kd">private</span> <span class="kd">func</span> <span class="nf">onPizzaIsReady</span><span class="p">(</span><span class="nv">pizza</span><span class="p">:</span> <span class="kt">Pizza</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Calling the closure in order to "deliver" the pizza</span>
    <span class="k">self</span><span class="o">.</span><span class="nf">completion</span><span class="p">?(</span><span class="n">pizza</span><span class="p">)</span>
    <span class="k">self</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="kc">nil</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Customer</span> <span class="p">{</span>

  <span class="kd">func</span> <span class="nf">askPizzaioloToMakeAPizza</span><span class="p">(</span><span class="nv">pizzaiolo</span><span class="p">:</span> <span class="kt">Pizzaiolo</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// We declare the body of the closure in a place where it is passed as an input parameter</span>
    <span class="n">pizzaiolo</span><span class="o">.</span><span class="nf">makePizza</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="p">{</span> <span class="n">pizza</span> <span class="k">in</span>
      <span class="c1">// We're inside the closure! And we've got the pizza!</span>
      <span class="c1">// This code gets executed when pizzaiolo calls the closure we passed to him</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="advantages-of-using-closure-block"><a name="Closure_advantages"><a href="#Closure_advantages">Advantages of using Closure (Block)</a></a></h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Loose_coupling">Loose coupling</a> - the callee and caller must agree only on the signature of the closure, which is the weakest <a href="https://en.wikipedia.org/wiki/Connascence_(computer_programming)#Static_Connascences">connascence of name</a>.</li>
  <li><a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)">High cohesion</a> of the business logic - the action and the response to the action can be declared together in one place.</li>
  <li>Capturing of the variables from the client’s context helps with state management because we don’t need to store the variables in the class and face potential access problems, such as the <a href="https://en.wikipedia.org/wiki/Race_condition">race condition</a>.</li>
  <li>Closures are <a href="https://github.com/nalexn/PerformanceTestTools">as fast</a> as calling a regular function.</li>
  <li>Just like with <a href="/callbacks-part-1-delegation-notificationcenter-kvo/#delegate"><code class="language-plaintext highlighter-rouge">delegation</code></a>, Closure can have non-<code class="language-plaintext highlighter-rouge">void</code> return type, so it also can be used as a <code class="language-plaintext highlighter-rouge">DataSource</code> for asking for data from the client code</li>
  <li>Full type safety. Using the static code analysis the IDE is able to check the signature of the closure and verify types of parameters passed in.</li>
</ul>

<h2 id="disadvantages-of-using-closure-block"><a name="Closure_disadvantages"><a href="#Closure_disadvantages">Disadvantages of using Closure (Block)</a></a></h2>
<ul>
  <li>Closures and blocks have quite <a href="http://fuckingclosuresyntax.com/">complex syntax</a></li>
  <li>For newcomers the concept of <a href="https://en.wikipedia.org/wiki/Anonymous_function">anonymous function</a> (or <a href="http://stackoverflow.com/questions/16501/what-is-a-lambda-function">lambda</a>) is harder to understand than most constructions from imperative programming</li>
  <li>Because <em>Swift</em> and <em>Objective-C</em> use <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/AutomaticReferenceCounting.html">automatic reference counting</a> memory management, closures can cause <a href="https://en.wikipedia.org/wiki/Memory_leak">memory leaks</a> when they form so-called <a href="http://stackoverflow.com/questions/24042949/block-retain-cycles-in-swift">retain cycle</a>. We should always be careful when using Closures and use <code class="language-plaintext highlighter-rouge">[weak ...]</code> modificator in cases where the cyclic capture takes place</li>
  <li>When used as <em>callbacks</em> for async operations, in practice the client code can often result in several nested in each other callbacks, which is called the <a href="https://en.wikipedia.org/wiki/Pyramid_of_doom_(programming)">pyramid of doom</a>, which is hard to read and support. Moreover, when the code flow inside the callbacks has branching (<code class="language-plaintext highlighter-rouge">if</code> - <code class="language-plaintext highlighter-rouge">else</code>) the pyramid size grows exponentially.</li>
  <li>Arguments of the closure or block cannot have argument labels. Because of that, the client code should assign names to each argument, which may lead to a wrong interpretation of the parameters after refactoring of the closure signature.</li>
  <li>[Obj-C] Blocks must be checked for <code class="language-plaintext highlighter-rouge">NULL</code> before being called, or the app will crash.</li>
</ul>

<h1 id="target-action-nsinvocation"><a name="Target-Action"><a href="#Target-Action">Target-Action (NSInvocation)</a></a></h1>

<p>Target-action on its own is a <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/Devpedia-CocoaApp/TargetAction.html">design pattern</a>, but conceptually it’s a variation of the <a href="https://en.wikipedia.org/wiki/Command_pattern">command</a>. Traditionally this callback technique is used in Cocoa for handling user interactions with the UI but is not restricted to this use case.</p>

<p>The client code provides two parameters in order to receive a callback in the future - an object and a function. In this context, the object is <code class="language-plaintext highlighter-rouge">target</code>, and the function is <code class="language-plaintext highlighter-rouge">action</code>.</p>

<p>The callback then is fulfilled by calling the <code class="language-plaintext highlighter-rouge">action</code> function on the <code class="language-plaintext highlighter-rouge">target</code> object.</p>

<p>It’s not a trivial case for a programming language when an object and its function are provided separately, so this technique requires support from the language.</p>

<p>For example, Swift does not allow us to do the trick of calling an arbitrary method on an arbitrary object, so we’d need to appeal to Objective-C if we wanted something like that to work in Swift project.</p>

<p>On the other hand, there are a few ways how we can perform the <em>action</em> on the <em>target</em> in Objective-C (thanks to volatile Objective-C runtime). In this example, I’m using the class <a href="https://developer.apple.com/reference/foundation/nsinvocation">NSInvocation</a>, which suits our needs the best.</p>

<p>Implementation of the <a href="/callbacks-part-1-delegation-notificationcenter-kvo/#Pizzeria_Problem"><em>Pizzeria</em></a> problem with target-action would look like this:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre><span class="k">@interface</span> <span class="nc">Pizzaiolo</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="c1">// The target and the action are sent separately</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">makePizzaForTarget</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">target</span> <span class="nf">selector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@interface</span> <span class="nc">Customer</span><span class="p">:</span> <span class="nc">NSObject</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">askPizzaioloToMakePizza</span><span class="p">:(</span><span class="n">Pizzaiolo</span> <span class="o">*</span><span class="p">)</span><span class="nv">pizzaiolo</span><span class="p">;</span>

<span class="k">@end</span>

<span class="c1">// ------ </span>

<span class="k">@implementation</span> <span class="nc">Pizzaiolo</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">makePizzaForTarget</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">target</span> <span class="nf">selector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span>
<span class="p">{</span>
  <span class="n">NSInvocation</span> <span class="o">*</span><span class="n">invocation</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">invocationForTarget</span><span class="p">:</span><span class="n">target</span> <span class="nf">selector</span><span class="p">:</span><span class="n">selector</span><span class="p">];</span>
  <span class="c1">// Storing the reference to the invocation object to be used later</span>
  <span class="n">self</span><span class="p">.</span><span class="n">invocation</span> <span class="o">=</span> <span class="n">invocation</span><span class="p">;</span>

  <span class="c1">// making pizza</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">onPizzaIsReady</span><span class="p">:(</span><span class="n">Pizza</span> <span class="o">*</span><span class="p">)</span><span class="nv">pizza</span>
<span class="p">{</span>
  <span class="c1">// Argument indices start from 2, because indices 0 and 1 indicate the hidden arguments self and _cmd</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">invocation</span><span class="p">.</span><span class="n">methodSignature</span><span class="p">.</span><span class="n">numberOfArguments</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">invocation</span> <span class="nf">setArgument</span><span class="p">:</span><span class="o">&amp;</span><span class="n">pizza</span> <span class="nf">atIndex</span><span class="p">:</span><span class="mi">2</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">invocation</span> <span class="nf">invoke</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// A helper method that constructs NSInvocation for given target and action</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSInvocation</span> <span class="o">*</span><span class="p">)</span><span class="nf">invocationForTarget</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">target</span> <span class="nf">selector</span><span class="p">:(</span><span class="n">SEL</span><span class="p">)</span><span class="nv">selector</span>
<span class="p">{</span>
  <span class="n">NSMethodSignature</span> <span class="o">*</span><span class="n">signature</span> <span class="o">=</span> <span class="p">[</span><span class="n">target</span> <span class="nf">methodSignatureForSelector</span><span class="p">:</span><span class="n">selector</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">signature</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="k">return</span> <span class="nb">nil</span><span class="p">;</span>
  <span class="n">NSInvocation</span> <span class="o">*</span><span class="n">invocation</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSInvocation</span> <span class="nf">invocationWithMethodSignature</span><span class="p">:</span><span class="n">signature</span><span class="p">];</span>
  <span class="n">invocation</span><span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">;</span>
  <span class="n">invocation</span><span class="p">.</span><span class="n">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">invocation</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">Customer</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">askPizzaioloToMakePizza</span><span class="p">:(</span><span class="n">Pizzaiolo</span> <span class="o">*</span><span class="p">)</span><span class="nv">pizzaiolo</span>
<span class="p">{</span>
  <span class="p">[</span><span class="n">pizzaiolo</span> <span class="nf">makePizzaForTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">takePizza</span><span class="o">:</span><span class="p">)];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">takePizza</span><span class="p">:(</span><span class="n">Pizza</span> <span class="o">*</span><span class="p">)</span><span class="nv">pizza</span>
<span class="p">{</span>
  <span class="c1">// Yeah! Objective "pizza" completed</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="advantages-of-using-target-action"><a name="Target-Action_advantages"><a href="#Target-Action_advantages">Advantages of using Target-Action</a></a></h2>
<ul>
  <li>In some aspects target-action is similar to <a href="/callbacks-part-1-delegation-notificationcenter-kvo/#delegate"><code class="language-plaintext highlighter-rouge">delegation</code></a>, but has two great advantages over it:
    <ul>
      <li>The name of the callback function is not predefined and is to be provided by the client code. This greatly decouples the caller and the callee.</li>
      <li>It supports multiple recipients with individual methods to be called for each of them.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">NSInvocation</code> provides a way to get a non-<code class="language-plaintext highlighter-rouge">void</code> result of invocation, so this technique can be used for requesting data (but I would not recommend to do it - read the disadvantages).</li>
  <li>Static code analyzer is able to perform at least shallow check of the method name provided as <em>action</em>. It cannot tell if the <em>target</em> is actually implementing the <em>action</em>.</li>
</ul>

<h2 id="disadvantages-of-using-target-action"><a name="Target-Action_disadvantages"><a href="#Target-Action_disadvantages">Disadvantages of using Target-Action</a></a></h2>
<ul>
  <li>Complex infrastructure. For target-action we need to implement everything ourselves:
    <ul>
      <li>Constructing <code class="language-plaintext highlighter-rouge">NSInvocation</code> the right way</li>
      <li>Managing a collection of <code class="language-plaintext highlighter-rouge">NSInvocation</code> in order to support multiple targets and actions.</li>
    </ul>
  </li>
  <li>Compiler is unable to check that the receiver can handle the selector it provides as an action. This often leads to crashes at runtime after inattentive code refactoring.</li>
  <li><code class="language-plaintext highlighter-rouge">NSInvocation</code> doesn’t automatically nullify reference to the target which got deallocated, so the app can crash at the runtime when the callback is triggered. Thus every target should explicitly remove itself from target-action.</li>
  <li>For the client code it is not clear which method signature should the <em>action</em> have (how many parameters and of which type). Passing around arguments is quite error-prone. The same applies to the returned type. Static code analyzer won’t be able to warn of any type discrepancies.</li>
  <li>Shares with <a href="/callbacks-part-1-delegation-notificationcenter-kvo/#delegate"><code class="language-plaintext highlighter-rouge">delegate</code></a> the problem of distributed business logic (<a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)">low cohesion</a>) and promotion of the <a href="https://www.smashingmagazine.com/2016/05/better-architecture-for-ios-apps-model-view-controller-pattern/">massive view controller</a>.</li>
</ul>

<h1 id="responder-chain"><a name="Responder_chain"><a href="#Responder_chain">Responder chain</a></a></h1>
<p>Although <em>responder chain</em> is the core mechanism in <code class="language-plaintext highlighter-rouge">UIKit</code> originally designed for distribution of touch and motion input events for the views and view controllers, it certainly can be used as a callback technique and in some cases is a great alternative to the <code class="language-plaintext highlighter-rouge">delegation</code>.</p>

<p>On its core responder chain is a beautiful application of the <a href="https://en.wikipedia.org/wiki/Chain-of-responsibility_pattern">chain of responsibility</a> design pattern. The central role in the responder chain is allocated to the <a href="https://developer.apple.com/reference/uikit/uiresponder"><code class="language-plaintext highlighter-rouge">UIResponder</code></a> class.</p>

<p>In Cocoa pretty much every class related to the UI is a direct or indirect descendant of the <code class="language-plaintext highlighter-rouge">UIResponder</code> class, thus the responder chain is truly pervasive in the app and includes every <em>view</em> on the screen, their <em>view controllers</em>, and even the <code class="language-plaintext highlighter-rouge">UIApplication</code> itself.</p>

<p>A great feature of the responder chain is that it is maintained automatically unless the developer wants to implement a custom <code class="language-plaintext highlighter-rouge">UIResponder</code> (which I cannot foresee when might be needed).</p>

<p>So, suppose you have this nontrivial view hierarchy:</p>

<p><code class="language-plaintext highlighter-rouge">UIApplication</code> – <code class="language-plaintext highlighter-rouge">UIWindow</code> – <strong><code class="language-plaintext highlighter-rouge">ViewController A</code></strong> – <code class="language-plaintext highlighter-rouge">ViewController</code> – <code class="language-plaintext highlighter-rouge">View</code> – <strong><code class="language-plaintext highlighter-rouge">Subview B</code></strong></p>

<p>The responder chain allows the <code class="language-plaintext highlighter-rouge">Subview B</code> send a message to the <code class="language-plaintext highlighter-rouge">ViewController A</code> with ease. The <code class="language-plaintext highlighter-rouge">ViewController A</code> should just be the first in the chain who implements the selector that <code class="language-plaintext highlighter-rouge">Subview B</code> is sending. And if no one including <code class="language-plaintext highlighter-rouge">UIApplication</code> can handle the selector - it just gets discarded and the app does not crash.</p>

<p>Not every <code class="language-plaintext highlighter-rouge">UIResponder</code> can send a message in the pipe - in Cocoa, there are only two classes which can do it: <code class="language-plaintext highlighter-rouge">UIControl</code> and <code class="language-plaintext highlighter-rouge">UIApplication</code>, and <code class="language-plaintext highlighter-rouge">UIControl</code> in fact <a href="https://developer.apple.com/reference/uikit/uiapplication/1622946-sendaction">uses UIApplication’s API</a> for that.</p>

<p>It’s possible to send actions on behalf of <code class="language-plaintext highlighter-rouge">UIControl</code>…</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">let</span> <span class="nv">control</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">()</span>
<span class="c1">// UIControl should be added to the view hierarchy</span>
<span class="n">view</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">control</span><span class="p">)</span>
<span class="n">control</span><span class="o">.</span><span class="nf">sendAction</span><span class="p">(</span><span class="kd">#selector(</span><span class="nf">handleAction(sender:)</span><span class="kd">)</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>… but normally you’d use <code class="language-plaintext highlighter-rouge">UIApplication</code></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="c1">// Triggering callback with UIApplication</span>

<span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">sendAction</span><span class="p">(</span><span class="kd">#selector(</span><span class="nf">handleAction(sender:)</span><span class="kd">)</span><span class="p">,</span> <span class="nv">to</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="k">self</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>As written in the <a href="https://developer.apple.com/reference/uikit/uiapplication/1622946-sendaction">docs</a>, if we provided non-<code class="language-plaintext highlighter-rouge">nil</code> UIResponder object in the <code class="language-plaintext highlighter-rouge">from</code> parameter (this could be our current view or view controller), the responder chain would start traversing from this element, otherwise, when the <code class="language-plaintext highlighter-rouge">from</code> parameter is <code class="language-plaintext highlighter-rouge">nil</code>, the traverse starts at the <em>first responder</em>.</p>

<p>For the needs of calling back through a few layers of nested child view controllers, we should always specify the <code class="language-plaintext highlighter-rouge">from</code> parameter, because <em>first responder</em> does not necessarily belong to our subviews hierarchy.</p>

<h2 id="advantages-of-using-responder-chain"><a name="Responder_chain_advantages"><a href="#Responder_chain_advantages">Advantages of using Responder chain</a></a></h2>
<ul>
  <li>Supported by every UIView and UIViewController in the project out of the box.</li>
  <li>Responder chain is managed automatically as the view hierarchy changes.</li>
  <li>Natively supported by the <em>Interface Builder</em> - without writing code at all you can choose to deliver action from a specific <code class="language-plaintext highlighter-rouge">UIControl</code> to the <em>first responder</em> in the chain.</li>
  <li>Action delivery is crash-safe. If there were no responder that agreed to step in and handle the action - nothing bad happens.</li>
  <li>Sometimes this is the easiest way to hear back from a <em>view</em> or <em>view controller</em> residing deeply in the view hierarchy. Normally you’d need to forward the callback through all the view controllers manually with a chain of delegates, and this implies writing custom classes for each UIViewController or UIView on the way. This technique truly saves us from writing a lot of code.</li>
</ul>

<h2 id="disadvantages-of-using-responder-chain"><a name="Responder_chain_disadvantages"><a href="#Responder_chain_disadvantages">Disadvantages of using Responder chain</a></a></h2>
<ul>
  <li>Responder chain is for <code class="language-plaintext highlighter-rouge">UIResponder</code> descendants only. Objects of arbitrary classes are not supported.</li>
  <li>You cannot send any useful data with the action. The parameters for the action are predefined as <code class="language-plaintext highlighter-rouge">sender: Any</code> and <code class="language-plaintext highlighter-rouge">event: UIEvent?</code>.</li>
  <li>It is impossible to get a non-<code class="language-plaintext highlighter-rouge">void</code> result of the call</li>
  <li>Responder chain is a <a href="https://en.wikipedia.org/wiki/Simplex_communication">simplex channel</a> and you cannot choose the direction.</li>
  <li>Just like any binding from <em>Interface Builder</em>, the connection may break as you refactor the code. There are <a href="https://github.com/fastred/IBAnalyzer">some tools</a> that can help with detecting the incorrect state.</li>
  <li>It is quite confusing for the newcomers why they have to use obscure <code class="language-plaintext highlighter-rouge">responder chain</code> for such <em>simple</em> thing as showing the on-screen keyboard in iOS</li>
</ul>

<p>To be continued…</p>

<hr />
<p>Be safe, brush your teeth, and write clean code.</p>

      <h2>Your appreciation is my inspiration!</h2>
      <p>I have tons of unpublished kick-ass materials and ideas, but I need your help! Consider sharing this article on <a href="https://twitter.com/share?url=http://nalexn.github.io/callbacks-part-2-closure-target-action-responder-chain/?utm_source=share_tw&amp;text=Callbacks, Part 2: Closure, Target-Action, and Responder chain&amp;hashtags=iosdev&amp;via=nallexn" title="Twitter" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-twitter share-button"></i></a>, <a href="https://www.facebook.com/sharer/sharer.php?u=http://nalexn.github.io/callbacks-part-2-closure-target-action-responder-chain/?utm_source=share_fb&amp;display=popup&amp;quote=Callbacks, Part 2: Closure, Target-Action, and Responder chain&amp;hashtag=#iosdev" title="Facebook" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-facebook-f share-button"></i></a> or <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://nalexn.github.io/callbacks-part-2-closure-target-action-responder-chain/?utm_source=share_in" title="LinkedIn" target="_blank" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=500');return false;"><i class="fa fa-linkedin share-button"></i></a>. This tiny action helps to grow this blog and inspires me to post more! (Or if you are nuts, <a href="https://venmo.com/nallexn" target="_blank">Venmo</a> me a drink!)</p>
      </p>
      <p>You can subscribe to <a href="http://nalexn.github.io/feed.xml" target="_blank">RSS feed</a> or follow my <a href="https://twitter.com/nallexn" target="_blank">Twitter</a> for the new articles alerts.

      <div style="width:0px; height:30px; display: block;"></div>
      <h2>Most recent articles</h2>
      <div class="content-box recent clearfix" style="padding: 20px 10px;">
        
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/layers_001.jpg)" href="/separation-of-concerns/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/separation-of-concerns/">Separation of Concerns in Software Design</a></h2>
              <p></p>
              <span class="post-date">2020, Jan 16&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">10 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/observable_001.jpg)" href="/swiftui-observableobject/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-observableobject/">Why I quit using the ObservableObject</a></h2>
              <p></p>
              <span class="post-date">2019, Dec 20&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">7 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/comparison_01.jpg)" href="/anyview-vs-group/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/anyview-vs-group/">Performance Battle: AnyView vs Group</a></h2>
              <p></p>
              <span class="post-date">2019, Dec 05&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">9 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/swiftui_unit_testing_01.jpg)" href="/swiftui-unit-testing/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-unit-testing/">Who said we cannot unit test SwiftUI views?</a></h2>
              <p></p>
              <span class="post-date">2019, Nov 21&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">12 minute read</span>
            </div>
          </article>
          
        
          
          <article class="post">
            
              <a class="post-thumbnail" style="background-image: url(/assets/img/deep_link_swiftui_01.jpg)" href="/swiftui-deep-linking/"></a>
            
            <div class="post-content">
              <h2 class="post-title"><a href="/swiftui-deep-linking/">Programmatic navigation in SwiftUI project</a></h2>
              <p></p>
              <span class="post-date">2019, Nov 08&nbsp;&nbsp;&nbsp;—&nbsp;</span>
              <span class="post-words">7 minute read</span>
            </div>
          </article>
          
        
        <article class="post">
          <a class="post-thumbnail" style="background-image: url(/assets/img/launch_001.jpg)" href="/"></a>
          <div class="post-content">
            <h2 class="post-title"><a href="/">Browse All Articles</a></h2>
            <p></p>
            <span class="post-date">Top iOS programming stuff, no kidding!</span>
          </div>
        </article>
      </div>
    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
</body>
</html>
